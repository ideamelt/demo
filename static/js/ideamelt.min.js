var IdeaMelt=window.IdeaMelt||{};IdeaMelt.init=function(a){if(!a||!a.api_key)return false;if(a.secure)IdeaMelt.baseUrl="https://api.ideamelt.com/v1/";else IdeaMelt.baseUrl="http://api.ideamelt.com/v1/";IdeaMelt.config=a;return true};!function(){var a;var b=function f(){};var c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var d=c.length;var e=window.console=window.console||{};while(d--){a=c[d];if(!e[a]){e[a]=b}}}();IdeaMelt.messageLog={info:[],error:[]};IdeaMelt.log=function(a,b){this.messageLog[a].push(b);console.log(b);if(a==="error")return false};IdeaMelt.listEndPoints=function(){var a=[];$.each(this.EndPoints,function(b){a.push(b)});return a};IdeaMelt.listEndPointParameters=function(a){var b=this.EndPoints[a].required;var c={required:b};if(this.EndPoints[a].optional){var d=this.EndPoints[a].optional;c["optional"]=d}return c};IdeaMelt.checkRequest=function(a,b){if(!a)return this.log("error","no endpoint given");if(!this.EndPoints[a])return this.log("error","not a valid endpoint");if(!b)return this.log("error","no options given");var c=this.EndPoints[a].required;var d=true;$.each(c,function(a){if(!b[c[a]])d=false});if(!d)return this.log("error","["+c+"] are required fields");if(this.EndPoints[a].optional){var e=this.EndPoints[a].optional;if(b[e[0]]&&b[e[1]])return this.log("error","only one of ["+e+"] are allowed");if(!b[e[0]]&&!b[e[1]])return this.log("error","atleast one of ["+e+"] are required")}return true};IdeaMelt.send=function(a,b,c,d){var e={crossDomain:true,api_key:IdeaMelt.config.api_key},f=$.extend(e,b),g=this.baseUrl+this.EndPoints[a].url,h=this.EndPoints[a].method;$.ajax({type:h,url:g,dataType:"json",data:f,success:function(a){if(a.success&&c)c(a);if(!a.success&&d)d(a)},error:function(a){if(d)d(a)}})};IdeaMelt.EndPoints={StoryCreate:{url:"story/create/",method:"POST",required:["user_url","action_type","object_type","object_url"]},UserExists:{url:"user/exists/",method:"GET",required:["user_url"]},UserCreate:{url:"user/create/",method:"POST",required:["user_url","title","avatar"]},UserFollow:{url:"user/follow/",method:"POST",required:["user_url"],optional:["user_to_follow","object_to_follow"]},UserFollowers:{url:"user/user_followers/",method:"GET",required:["user_url"]},UserFollowing:{url:"user/user_following/",method:"GET",required:["user_url"]},ObjectsFollowing:{url:"user/objects_following/",method:"GET",required:["user_url"]},IsFollowingUser:{url:"user/is_following_user/",method:"GET",required:["user_url","following_user_url"]},IsFollowingObject:{url:"user/is_following_object/",method:"GET",required:["user_url","following_object_url"]},NotifSend:{url:"notifications/send/",method:"POST",required:["to_user_url","from_user_url","content"]},NotifSendToFollowers:{url:"notifications/send_to_followers/",method:"POST",required:["from_user_url","content"]},NotificationsSend:{url:"notifications/send/",method:"POST",required:["to_user_url","from_user_url","content"]},NotificationsSendToFollowers:{url:"notifications/send_to_followers/",method:"POST",required:["from_user_url","content"]},UserFollowees:{url:"user/followees/",method:"GET",required:["user_url"]},ObjectsFollowed:{url:"user/objects_followed/",method:"GET",required:["user_url"]}};IdeaMelt.EventHooks={RTBComments:{notifications:function(a,b,c,d){if(a.events==undefined)return IdeaMelt.log("error","event subscription not possible. check app parameter");if(b){a.events.subscribe({topic:"Echo.StreamServer.Controls.Submit.onPostComplete",handler:function(a,b){if(Echo.UserSession.identity.loggedIn=="true"){if(b.inReplyTo!=undefined){var c={to_user_url:b.inReplyTo.actor.id,from_user_url:Echo.UserSession.get("identityUrl")};if(d!=undefined)c["content"]='<a href="'+Echo.UserSession.get("identityUrl")+'">'+Echo.UserSession.get("name")+"</a> replied to your post<br><i>"+b.inReplyTo.object.content+'</a></i><br><a href="'+d+'"<b>"'+b.postData.content[0].object.content+'"</b></a>';else c["content"]='<a href="'+Echo.UserSession.get("identityUrl")+'">'+Echo.UserSession.get("name")+"</a> replied to your post<br><i>"+b.inReplyTo.object.content+'</a></i><br><b>"'+b.postData.content[0].object.content+'"</b>';IdeaMelt.send("NotificationsSend",c)}}}})}if(c){a.events.subscribe({topic:"Echo.StreamServer.Controls.Stream.Item.Plugins.Like.onLikeComplete",handler:function(a,b){if(Echo.UserSession.identity.loggedIn=="true"){var c={to_user_url:b.item.data.actor.id,from_user_url:Echo.UserSession.get("identityUrl")};if(d!=undefined)c["content"]='<a href="'+Echo.UserSession.get("identityUrl")+'">'+Echo.UserSession.get("name")+'</a> liked your post<br><a href="'+d+'"<i>'+b.item.data.object.content+"</i></a>";else c["content"]='<a href="'+Echo.UserSession.get("identityUrl")+'">'+Echo.UserSession.get("name")+"</a> liked your post<br><i>"+b.item.data.object.content+"</i>";IdeaMelt.send("NotificationsSend",c)}}})}},stories:function(a,b,c){if(a.events==undefined)return IdeaMelt.log("error","event subscription not possible. check app parameter");if(b==undefined)return IdeaMelt.log("error","no objectType provided");if(c==undefined)return IdeaMelt.log("error","no objectUrl provided");a.events.subscribe({topic:"Echo.StreamServer.Controls.Submit.onPostComplete",handler:function(a,d){if(Echo.UserSession.identity.loggedIn=="true"){var e=d.postData.content[0].object.content;var f={user_url:Echo.UserSession.get("identityUrl"),action_type:"comment",object_type:b,object_url:c,comment:e};IdeaMelt.send("StoryCreate",f)}}})}}};!function(a,b){var c={};!function(){var a;var c=function g(){};var d=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var e=d.length;var f=b.console=b.console||{};while(e--){a=d[e];if(!f[a]){f[a]=c}}}();c.Class={unfollow:"im-unfollow",follow:"im-follow",disabled:"im-disabled"};c.init=function(b){if(b==undefined||b.length<1)console.log("Error - please provide an api-key");c.ajaxData={crossDomain:true,api_key:b};c.onEchoInit(function(){c.items=[];a('[data-ideamelt="follow"]').each(function(a,b){c.items.push(new c.Element(b))})});c.css('[data-ideamelt="follow"] {cursor:pointer;} .'+c.Class.disabled+" {pointer-events:none !important;}");a("body").on("im-toggle-follow",function(b){a.each(c.items,function(a,c){if(c.userToFollow==b.userToFollow){if(c.state&&!b.state)c.setToFollow();else if(!c.state&&b.state)c.setToUnFollow()}})})};c.onEchoInit=function(a,c){var d=0;var e=b.setInterval(function(){if(d==20){b.clearInterval(e);if(c!=undefined)c()}else if(b.Echo!=undefined&&b.Echo.UserSession!=undefined&&b.Echo.UserSession.identity!=undefined){b.clearInterval(e);if(a!=undefined)a()}else{d++}},100)};c.request=function(b,d,e,f,g){a.ajax({type:b,url:d,dataType:"json",data:a.extend({},c.ajaxData,e),success:function(a){if(a.success){f(a)}else{g(a)}},error:function(a){g(a)}})};c.refresh=function(){a.each(c.items,function(a,b){b.checkRelationship()})};c.Element=function(c){var d=this;this.$item=a(c);this.userToFollow=this.$item.data("user-to-follow")==undefined?console.log("user-to-follow data-attribute missing"):this.$item.data("user-to-follow");this.userUrl=this.$item.data("user-url")!=undefined?this.$item.data("user-url"):b.Echo.UserSession.get("identityUrl");this.title=this.$item.data("title")==undefined?"":" "+this.$item.data("title");if(b.Echo.UserSession.is("logged")){this.checkRelationship();this.$item.off("click.im-follow");this.$item.on("click.im-follow",function(){d.toggleRelationship()})}else{this.$item.text("Follow")}};c.Element.prototype.setToFollow=function(){this.state=false;this.$item.addClass(c.Class.follow).removeClass(c.Class.unfollow).removeClass(c.Class.disabled).text("Follow"+this.title)};c.Element.prototype.setToUnFollow=function(){this.state=true;this.$item.addClass(c.Class.unfollow).removeClass(c.Class.follow).removeClass(c.Class.disabled).text("Unfollow"+this.title)};c.Element.prototype.checkRelationship=function(){var a=this;this.$item.addClass(c.Class.disabled);new c.request("GET","https://api.ideamelt.com/v1/user/is_following_user",{user_url:this.userUrl,following_user_url:this.userToFollow},function(b){if(b.is_followed)a.setToUnFollow();else if(!b.is_followed)a.setToFollow();else console.log(b);a.$item.removeClass(c.Class.disabled)},function(b){a.$item.removeClass(c.Class.disabled);console.log(b)})};c.Element.prototype.toggleRelationship=function(){var b=this;this.$item.addClass(c.Class.disabled);new c.request("POST","https://api.ideamelt.com/v1/user/follow",{user_url:this.userUrl,user_to_follow:this.userToFollow},function(d){if(d.result)b.setToUnFollow();else if(!d.result)b.setToUnFollow();else console.log(d);b.$item.removeClass(c.Class.disabled);a("body").trigger({type:"im-toggle-follow",state:d.result,userToFollow:b.userToFollow})},function(a){b.$item.removeClass(c.Class.disabled);console.log(a)})};c.css=function(b){var c=a('<style type="text/css">'+b+"</style>");a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(c)};b.IdeaMelt=b.IdeaMelt||{};b.IdeaMelt.Apps=b.IdeaMelt.Apps||{};b.IdeaMelt.Apps.Follow=c}($,window);!function(a){"use strict";var b=a;var c=Echo.App.manifest("IdeaMelt.Apps.SocialStream");if(Echo.App.isDefined("IdeaMelt.Apps.SocialStream"))return;c.init=function(){if(!this.config.get("imAppkey")||!this.config.get("baseDomain")||!this.config.get("namespace"))return;if(this.config.get("debug"))this.log({message:"stream app initialized"});if(this.config.get("app")=="newsfeed"){this.config.set("aggregator",true);this.config.set("personalize",true)}else if(this.config.get("app")=="userfeed"){this.config.set("aggregator",true);this.config.set("personalize",false);if(this.config.get("userUrls")==undefined||this.config.get("userUrls")[0]==undefined||this.config.get("userUrls").length>1){this.log({message:"user url required"});return false}}else if(this.config.get("app")=="siteticker"){this.config.set("aggregator",false);this.config.set("personalize",false);this.config.set("compact",true)}this.setQueryUrls();if(this.config.get("aggregator")){this.aggregator()}if(this.config.get("personalize")){this.getNewsfeed()}else{this.render();this.ready()}if(this.user.is("logged"))this.userHandler()};c.dependencies=[{url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}];c.config={app:undefined,imAppkey:undefined,baseDomain:undefined,namespace:undefined,appkey:undefined,debug:false,liveUpdatesInterval:5,itemsPerPage:20,sortOrder:"reverseChronological",symbolLink:"http://www.nasdaq.com/symbol/[xxx]/stream",metaLayout:"compact",userUrls:false,aggregator:true,compact:false,personalize:true,personalizeUrl:false,useSecureAPI:false,filter:false,autoLikeNotifs:false,autoReplyNotifs:false};c.templates.imStream='<div class="{class:imstream}"></div>';c.methods.setQueryUrls=function(){var a=this.config.get("baseDomain");if(a.substring(a.length-1,a.length)==="/"){a=a.substring(0,a.length-1)}var b=this.config.get("namespace");var c=a+"/"+b+"/stories";var d=a+"/pulse";this.config.set("storiesUrl",c);this.config.set("pulseUrl",d)};c.methods.aggregator=function(){var a=this;Echo.Events.subscribe({topic:"Echo.StreamServer.Controls.Stream.onDataReceive",handler:function(b,c){var d=a.getQuery();if(d===c.query){c.entries=a.aggregate(c);c.entries=[]}}})};c.methods.aggregate=function(a){var c=[];var d=[];var e={},f={};b.each(a.entries,function(a,c){if(c.provider.name==="Idea Melt"){var d=b(c.object.content).data("graph");d.id=c.id;var g=d.meta.url+"_"+d.object["object-slug"]+"_"+d.action["action-slug"];if(!(g in e)){e[g]=[]}e[g].push(c);var h=c.actor.id+"_"+d.object["object-slug"]+"_"+d.action["action-slug"];if(!(h in f)){f[h]=[]}f[h].push(c)}});b.each(e,function(a,e){if(e.length===1){}else{var f=b.inArray(e[0].id,d)===-1?e[0]:e[1];var g=[];var h=[];var i={};b.each(e,function(a,c){var d=b(c.object.content).data("graph");var e=c.actor.id+"_"+d.object["object-slug"]+"_"+d.action["action-slug"]+"_"+d.meta.url;if(!(e in i)){g.push(c.actor);h.push(c.id);i[e]=[]}});if(g.length>1){f["im_aggregate"]=true;f["im_aggregate_type"]="users";f["im_aggregate_users"]=g;c.push(f);d=d.concat(h)}}});b.each(f,function(a,e){var f;if(e.length===1){f=e[0];if(b.inArray(f.id,d)===-1){c.push(f);d.push(f.id)}}else{f=b.inArray(e[0].id,d)===-1?e[0]:e[1];var g=[];var h=[];var i={};b.each(e,function(a,c){var e=b(c.object.content).data("graph");var f=c.actor.id+"_"+e.object["object-slug"]+"_"+e.action["action-slug"]+"_"+e.meta.url;if(!(f in i)&&b.inArray(c.id,d)===-1){h.push(c.id);g.push(b(c.object.content).data("graph"));i[f]=[]}});if(g.length>1){f["im_aggregate"]=true;f["im_aggregate_type"]="objects";f["im_aggregate_objects"]=g;c.push(f);d=d.concat(h)}else{if(b.inArray(f.id,d)===-1){c.push(f);d.push(f.id)}}}});var g=[];var h={};b.each(c,function(a,c){var d=b(c.object.content).data("graph");var e=c.actor.id+"_"+d.object["object-slug"]+"_"+d.action["action-slug"]+"_"+d.meta.url;if(!(e in h)){g.push(c);h[e]=[]}});var i=b.map(g,function(a){return a.id});b.each(a.entries,function(a,c){if(b.inArray(c.id,i)===-1){c.im_remove=true}});if(this.config.get("debug"))this.log({message:g});return g};c.methods.userHandler=function(){if(Echo.UserSession.is("logged")){if(this.config.get("debug"))this.log({message:"logged"});this.checkUser()}else{if(this.config.get("debug"))this.log({message:"not-logged"})}};c.methods.checkUser=function(){if(Echo.UserSession.is("logged")){var a="https://api.ideamelt.com/v1/user/create/";var c=Echo.UserSession.get("photos");var d={api_key:this.config.get("imAppkey"),user_url:Echo.UserSession.get("identityUrl"),title:Echo.UserSession.get("username"),avatar:c[0]["value"]};b.post(a,d)}return};c.methods.getElement=function(a,b){var c=this.cssPrefix+a;var d=this.config.get("target");if(b){return c}else{return d.find("."+c)}};c.methods.getNewsfeed=function(){if(!Echo.UserSession.is("logged")&&!this.config.get("personalizeUrl")){this.render();this.ready();return false}this.set("newsfeedUrls","");var a=this;var c=this.config.get("imAppkey");if(this.config.get("personalizeUrl"))var d=this.config.get("personalizeUrl");else var d=Echo.UserSession.get("identityUrl");var e={api_key:c,user_url:d};var f="https://api.ideamelt.com/v1/user/";new Echo.API.Request({apiBaseURL:f,endpoint:"followees",transport:"json",secure:this.config.get("useSecureAPI"),data:e,onData:function(c){if(!c.success){var e=[d]}else{var e=b.map(c.followees_list,function(a){return a.url})}a.set("newsfeedUrls",e);a.render();a.ready()}}).request()};c.methods.template=function(){return this.templates.imStream};c.methods.getQuery=function(){var a=this.config.get("compact")?":0":"";var c="user.state:Untouched,ModeratorApproved state:Untouched,ModeratorApproved children"+a+" user.state:Untouched,ModeratorApproved state:Untouched,ModeratorApproved safeHTML:off";var d=this.config.get("itemsPerPage");var e=this.config.get("sortOrder");var f=this.config.get("storiesUrl");var g=this.config.get("pulseUrl");var h=this.config.get("namespace");var i=this.config.get("pulseSource",h);var j=this.config.get("userUrls");var k="";if(j instanceof Array&&j.length>0&&j[0].length>0){var l=b.map(j,function(a){return'"'+a+'"'});k+=l.join(",")}if(this.config.get("personalize")&&this.user.is("logged")){var m=this.get("newsfeedUrls");if(m instanceof Array&&m.length>0&&m[0].length>0){var n=b.map(m,function(a){return'"'+a+'"'})}if(k.length>0&&m.length>0)k+=", ";if(n!=undefined)k+=n.join(",")}if(k.length>0)k=" user.id:"+k;var o="(childrenof:"+f+k+") OR (childrenof:"+g+" source:"+i+k+")";var p=this.config.get("filter");if(p){p=p.toLowerCase();if(p==="pulse"){o="childrenof:"+g+" source:"+i+k}else if(p==="stories"){o="childrenof:"+f+k}}var q=o+" itemsPerPage:"+d+" sortOrder:"+e+" "+c;return q};c.methods.autoLikeNotifs=function(){var a=this;this.events.subscribe({topic:"Echo.StreamServer.Controls.Stream.Item.Plugins.Like.onLikeComplete",handler:function(c,d){var e={api_key:a.config.get("imAppkey"),to_user_url:d.item.data.actor.id,from_user_url:a.user.get("identityUrl")};if(d.item.data.object.title==undefined){e["content"]='<a href="'+a.user.get("identityUrl")+'">'+a.user.get("name")+"</a> liked your post<br><i>"+d.item.data.object.content+"</i>"}else{var f=b(d.item.data.object.content).data("graph");e["content"]='<a href="'+a.user.get("identityUrl")+'">'+a.user.get("name")+'</a> liked your activity<br><i><a href="'+f.meta.url+'">'+d.item.data.object.title+"</a></i>"}a.sendNotif(e)}})};c.methods.autoReplyNotifs=function(){var a=this;this.events.subscribe({topic:"Echo.StreamServer.Controls.Submit.onPostComplete",handler:function(c,d){var e={api_key:a.config.get("imAppkey"),to_user_url:d.inReplyTo.actor.id,from_user_url:a.user.get("identityUrl")};if(d.inReplyTo.object.title==undefined){e["content"]='<a href="'+a.user.get("identityUrl")+'">'+a.user.get("name")+"</a> replied to your post<br><i>"+d.inReplyTo.object.content+'</a></i><br><b>"'+d.postData.content[0].object.content+'"</b>'}else{var f=b(d.inReplyTo.object.content).data("graph");e["content"]='<a href="'+a.user.get("identityUrl")+'">'+a.user.get("name")+'</a> replied to your activity<br><i><a href="'+f.meta.url+'">'+d.inReplyTo.object.title+'</a></i><br><b>"'+d.postData.content[0].object.content+'"</b>'}a.sendNotif(e)}})};c.methods.sendNotif=function(a){var b=this;var c="https://api.ideamelt.com/v1/notifications/";new Echo.API.Request({apiBaseURL:c,endpoint:"send",secure:b.config.get("useSecureAPI"),data:a,onData:function(a){b.log({message:a})}}).request()};c.renderers.imstream=function(a){var b=this.config.get("liveUpdatesInterval");var c=this.config.get("symbolLink");var d=this.config.get("maxBodyCharacters");var e=this.config.get("metaLayout");var f=this.config.get("baseDomain");var g=this.getQuery();var h=this.config.get("aggregator");var i=this.config.get("compact");if(i){a.addClass("im-compact")}this.initComponent({id:"Stream",component:"Echo.StreamServer.Controls.Stream",config:{target:a,query:g,plugins:[{name:"IdeaMeltStreamFull",symbolLink:c,metaLayout:e,aggregator:h,compact:i},{name:"Like"},{name:"Reply",actionString:"Write a comment...",source:{name:"IMStream",uri:f},nestedPlugins:[{name:"FormAuth",submitPermissions:"forceLogin"}]}],state:{label:{icon:false,text:false}},item:{reTag:false,contentTransformations:{text:["hashtags","urls","newlines"],html:["hashtags","urls","newlines"],xhtml:["hashtags","urls"]}},liveUpdates:{enabled:true,timeout:b},flashColor:"#C6E9F6",fadeTimeout:6e3,useSecureAPI:this.config.get("useSecureAPI")}});if(this.config.get("autoLikeNotifs"))this.autoLikeNotifs();if(this.config.get("autoReplyNotifs"))this.autoReplyNotifs();return a};c.css=".{class:imstream} .echo-streamserver-controls-stream-header {display:none;}"+".im-compact .echo-streamserver-controls-stream-item-footer{display:none}"+".im-compact .echo-streamserver-controls-stream-item-plugin-Like-likedBy{display:none!important}"+".im-compact .echo-streamserver-controls-stream-item-subwrapper {margin-left: 42px;}"+".im-compact .echo-streamserver-controls-stream-item-container-root{padding:10px 0; border-bottom:1px solid #eee; font-size:11px}"+".im-compact .echo-streamserver-controls-stream-item-avatar {width:32px; height:32px}"+".im-compact .echo-linkColor {color: #333;}";Echo.App.create(c)}(Echo.jQuery);!function(a){"use strict";var b=a;var c=Echo.Plugin.manifest("IdeaMeltStreamFull","Echo.StreamServer.Controls.Stream.Item");if(Echo.Plugin.isDefined(c))return;c.init=function(){var a=this.component.get("data.provider.name");if(a==="Idea Melt"){this.extendTemplate("replace","body",c.template)}else{this.extendTemplate("replace","authorName",c.authorTemplate);this.extendTemplate("replace","text",c.textTemplate)}this.extendTemplate("replace","avatar",c.avatarTemplate)};c.template=function(){var a=this.config.get("metaLayout")==="compact"?"im-compact-meta":"";return'<div class="{plugin.class:im-story-container}"></div>'+'<div class="{plugin.class:wrapper} '+a+'"></div>'};c.methods.imObject=function(a,b){var c=this.cssPrefix+"im-object";var d=this.cssPrefix+"imgholder";var e=this.cssPrefix+"text";var f=this.cssPrefix+"title";var g=this.cssPrefix+"metaurl";if(a.action["action-slug"]=="comment")var h=this.cssPrefix+"item-comment-frame";else var h=this.cssPrefix+"item-text-frame";var i=this.config.get("metaLayout")==="compact"?48:90;var j=a.meta.url;var k=j.replace("http://","").replace("https://","").replace("www.","").split("/")[0];if(a.action["action-slug"]=="comment")var l='"'+a.meta.comment+'"';else var l=a.meta.description;if(!l){l=""}if(!b){b=300}if(l.length>b){l=l.slice(0,b)+"..."}var m='<div class="'+c+'">'+'<div class="'+d+'"><a target="blank" href="'+a.meta.url+'"><img src="'+a.meta.image+'" width="'+i+'" /></a></div>'+'<div class="'+e+'">'+'<div class="'+f+' echo-linkColor">'+'<a class="echo-primaryColor" target="_blank" href="'+a.meta.url+'">'+a.meta.title+"</a></div>"+'<div class="'+g+'"><a href="'+a.meta.url+'">'+k+"</a></div>"+'<div class="echo-primaryColor '+h+'">'+l+"</div>"+"</div></div>";return m};c.authorTemplate='<div class="{class:authorName} {plugin.class:authorNameLink}"></div>';c.avatarTemplate='<div class="{class:avatar} {plugin.class:avatarLink}"></div>';c.textTemplate='<span class="{class:text} {plugin.class:textSymbol}"></span>';c.renderers.authorNameLink=function(a){var b=this.component.get("data.actor");return a.html('<a href="'+b.id+'">'+b.title+"</a>")};c.renderers.textSymbol=function(a){var c=this;var d=a.find(".echo-stock-tag");d.each(function(){var a=b(this).text();var d=c.config.get("symbolLink");var e=d.replace("[xxx]",a);b(this).attr("href",e)});return a};c.renderers.avatarLink=function(a){var b=Echo.Utils.loadImage({image:this.component.data.actor.avatar,defaultImage:this.config.get("defaultAvatar")});var c=this.config.get("compact");var d=c?32:48;var e=this.component.depth;if(this.config.get("debug"))this.log({message:e});if(e){d=24}b.css({width:d,height:d});var f=this.component.data.actor.id;a.html('<a href="'+f+'"></a>');a.find("a").html(b);return a};c.renderers.wrapper=function(a){var c=this;var d=this.component;var e=d.view.get("body");d.view.remove("authorName");if(this.component.data.im_remove){this.component.destroy()}var f=b(this.component.data.object.content).data("graph");var g=f.meta.url;var h=g.replace("http://","").replace("https://","").replace("www.","").split("/")[0];var i=Echo.Utils.loadImage({image:f.meta.image,defaultImage:this.config.get("defaultAvatar")});var j=this.config.get("metaLayout")==="compact"?48:90;i.css({width:j,height:j});var k='<a class="echo-linkColor imstoryactor" target="_blank" style="font-weight:bold;" href="'+this.component.data.actor.id+'">'+this.component.data.actor.title+"</a>";var l=f.action["action-singular"];var m=f.object["object-determiner"]+' <a class="echo-linkColor" target="_blank" href="'+f.meta.url+'">'+f.object["object-singular"]+".</a>";if(this.config.get("compact")){m='<a class="echo-linkColor" target="_blank" href="'+f.meta.url+'">'+f.meta.title+".</a>"}var n="";if(this.component.data.im_aggregate&&this.component.data.im_aggregate_type==="users"){var o=this.component.data.im_aggregate_users.length-1;var p=this.component.data.im_aggregate_users.slice(1,o+1);var q=p;p=b.map(p,function(a){return a.title});var r=p.join(", ");n=o>1?'and <span rel="tooltip" title="'+r+'" class="im-multiple echo-linkColor">'+o+" other people</span> ":'and <a class="echo-linkColor imstoryactor" target="_blank" style="font-weight:bold;" href="'+q[0].id+'">'+q[0].title+"</a> ";l=f.action["action-plural"]}var s=[f];if(this.component.data.im_aggregate&&this.component.data.im_aggregate_type==="objects"){var o=this.component.data.im_aggregate_objects.length;var t=b.map(this.component.data.im_aggregate_objects,function(a){return a.meta.title});var u=t.join(", ");var m='<span rel="tooltip" title="'+u+'" class="echo-linkColor im-multiple">'+o+" "+f.object["object-plural"]+"</span>";var v=this.component.data.im_aggregate_objects.slice(1,o);s=s.concat(v)}var w=k+" "+n+l+" "+m;this.view.get("im-story-container").empty().append(w);var x="";var y=null;if(s.length>1){y=140}b.each(s,function(a,b){x+=c.imObject(b,y)});if(!this.config.get("compact",false)){this.view.get("wrapper").empty().append(x)}else{this.view.get("wrapper").remove()}return a};c.css=".{plugin.class:imgcontainer} { width:90px;height:90px;padding:5px; }"+".{plugin.class:wrapper} { background-color:#f7f7f7;margin-top:10px; border:1px solid #ccc; min-height:92px; margin-bottom:7px}"+".{plugin.class:imgholder} { float:left; width:90px; height:90px; overflow:hidden}"+".{plugin.class:imgholder} img {width:90px;}"+".{plugin.class:text} {margin-left:10px; padding-top:5px; margin-left:100px}"+".{plugin.class:title} { font-weight:bold; }"+".{plugin.class:metaurl} {padding:3px 0}"+".{plugin.class:metaurl} a { font-weight:normal; color:#666; font-size:11px;}"+".{plugin.class:wrapper}.im-compact-meta{ background: none;border: none;min-height: 50px;border-left: 2px solid #DDD;padding-left: 10px;}"+".{plugin.class:wrapper}.im-compact-meta .{plugin.class:imgholder}{width:48px; height:48px; overflow:hidden}"+".{plugin.class:wrapper}.im-compact-meta .{plugin.class:imgholder} img{width:48px;}"+".{plugin.class:wrapper}.im-compact-meta .{plugin.class:text}{ padding-top: 0px;margin-left: 60px;}"+".{plugin.class:item-text-frame} {color:#666; font-size:11px}"+".{plugin.class:item-comment-frame} {font-style: italic;}"+".im-multiple{cursor:default}"+".{plugin.class:im-object} {padding-bottom:20px}"+".{plugin.class:im-object}:last-child {padding-bottom:0px}";Echo.Plugin.create(c)}(Echo.jQuery);!function(a,b){var c={};!function(){var a;var c=function g(){};var d=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var e=d.length;var f=b.console=b.console||{};while(e--){a=d[e];if(!f[a]){f[a]=c}}}();c.config={api_key:undefined,quantity:3,target:undefined,style:false};c.Suggestions=[];c.Fallback=[];c.Class={item:"im-suggested-item",itemAvatar:"im-suggested-itemAvatar",itemTitle:"im-suggested-itemTitle",itemLink:"im-suggested-itemLink",itemFollow:"im-suggested-itemFollow",itemDisabled:"im-suggested-itemDisabled"};c.userTemplate='<div class="{{item}}">'+'<a class="{{itemLink}}" href="{{this.url}}">'+'<img class="{{itemAvatar}}" src="{{this.avatar}}"></img>'+'<div class="{{itemTitle}}">{{this.title}}</div>'+"</a>"+'<a class="{{itemFollow}}" href="JavaScript:void(0);">'+"Follow"+"</a>"+"</div>";c.init=function(b){if(b.api_key==undefined||typeof b.api_key!="string")console.log("Error - please provide a valid api-key");else if(b.target==undefined||a(b.target).length!=1)console.log("Error - please provide a single, valid target");else{b.target=a(b.target).eq(0);a.extend(true,c.config,b);c.ajaxData={crossDomain:true,api_key:c.config.api_key};if(c.config.style)c.injectStyle();c.onEchoInit(function(){Echo.Events.subscribe({topic:"Echo.UserSession.onInit",handler:function(a,b){if(Echo.UserSession._isLogged())c.getSuggestions()}})},function(){});return}return false};c.onEchoInit=function(a,c){var d=0;var e=b.setInterval(function(){if(d==20){b.clearInterval(e);if(c!=undefined)c()}else if(b.Echo!=undefined&&b.Echo.UserSession!=undefined&&b.Echo.UserSession.identity!=undefined){b.clearInterval(e);if(a!=undefined)a()}else{d++}},100)};c.css=function(b){var c=a('<style type="text/css">'+b+"</style>");a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(c)};c.request=function(b,d,e,f,g){a.ajax({type:b,url:d,dataType:"json",data:a.extend({},c.ajaxData,e),success:function(a){if(a.success){f(a)}else{g(a)}},error:function(a){g(a)}})};c.getSuggestions=function(a,b){if(!Echo.UserSession._isLogged())return;new c.request("GET","https://api.ideamelt.com/v1/user/follow_suggestions",{top:c.config.quantity,user_url:Echo.UserSession.get("identityUrl")},function(a){c.renderSuggestions(a.suggestions)},function(a){console.log(a);c.renderSuggestions(c.Fallback)})};c.renderSuggestions=function(b){c.Suggestions=[];c.config.target.find("."+c.Class.item).remove();a.each(b,function(a,b){c.Suggestions.push(new c.Item(b));if(a+1==c.config.quantity)return false})};c.Item=function(a){for(var b in a){this[b]=a[b]}this.render()};c.Item.prototype.compile=function(){var b=c.userTemplate;b=b.replace("{{this.url}}",this.url);b=b.replace("{{this.avatar}}",this.avatar);b=b.replace("{{this.title}}",this.title);b=b.replace("{{this.following_count}}",this.following_count);for(var d in c.Class){b=b.replace("{{"+d+"}}",c.Class[d])}this.$el=a(b);return this.$el};c.Item.prototype.render=function(){var b=this;c.config.target.append(this.compile());if(Echo.UserSession.is("logged")){this.$el.find("."+c.Class.itemFollow).on("click",function(c){c.preventDefault();c.stopPropagation();a(this).off("click");b.follow()})}};c.Item.prototype.follow=function(){var a=this;this.$el.find("."+c.Class.itemFollow).addClass(c.Class.itemDisabled);new c.request("POST","https://api.ideamelt.com/v1/user/follow",{user_to_follow:a.url,user_url:Echo.UserSession.get("identityUrl")},function(a){c.getSuggestions()},function(b){console.log(b);a.$el.find("."+c.Class.itemFollow).removeClass(c.Class.itemDisabled)})};c.injectStyle=function(){c.css("."+c.Class.item+"{width: 100%; margin-bottom: 20px; height: 48px; overflow: hidden; position: relative;}"+"."+c.Class.itemAvatar+"{height: 48px; position: absolute; top: 0px; left: 0px; max-width: 48px;}"+"."+c.Class.itemTitle+"{margin-left: 54px; font-size: 14px; line-height: 1; padding: 16px 0px 18px; text-decoration: none;}"+"."+c.Class.itemLink+"{display: inline-block;position: relative;height: 48px;overflow: hidden;text-decoration: none;}"+"."+c.Class.itemFollow+'{position: absolute; right: 0px; font-size: 14px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -o-border-radius: 4px; border-radius: 4px; background: #3399cc; background: -moz-linear-gradient(top, #3399cc 0%, #336699 100%); background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#3399cc), color-stop(100%,#336699)); background: -webkit-linear-gradient(top, #3399cc 0%,#336699 100%); background: -o-linear-gradient(top, #3399cc 0%,#336699 100%); background: -ms-linear-gradient(top, #3399cc 0%,#336699 100%); background: linear-gradient(to bottom, #3399cc 0%,#336699 100%); filter: progid:DXImageTransform.Microsoft.gradient( startColorstr="#3399cc", endColorstr="#336699",GradientType=0 ); color: #FFF; padding: 8px 12px 8px; top: 8px; text-decoration: none; -webkit-box-shadow: 0px 0px 12px 12px white; -moz-box-shadow: 0px 0px 12px 12px white; -o-box-shadow: 0px 0px 12px 12px white; box-shadow: 0px 0px 12px 12px white;}'+"."+c.Class.itemFollow+":hover{background: #0073ae; text-decoration: none;}"+"."+c.Class.itemDisabled+"{pointer-events: none; background: #BBB;}")};b.IdeaMelt=b.IdeaMelt||{};b.IdeaMelt.Apps=b.IdeaMelt.Apps||{};b.IdeaMelt.Apps.Suggested=c}($,window);!function(a){"use strict";var b=a;var c=Echo.App.manifest("IdeaMelt.Apps.TheNotifier");if(Echo.App.isDefined("IdeaMelt.Apps.TheNotifier"))return;c.init=function(){if(!this.config.get("appkey")){this.log({type:"error",message:"appkey not provided"});this.render();return false}if(!this.config.get("target")){this.log({type:"error",message:"target not provided"});this.render();return false}if(!this.config.get("imAppkey")){this.log({type:"error",message:"imAppkey not provided"});this.render();return false}if(!this.config.get("baseDomain")){this.log({type:"error",message:"baseDomain not provided"});this.render();return false}if(this.config.get("debug"))this.log({message:"app initialized"});this.userHandler();this.domEvents();this.ready();this.render()};c.dependencies=[{url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}];c.config={debug:false,imAppkey:undefined,baseDomain:undefined,liveUpdatesInterval:5,fadeToggleTimeout:200,useSecureAPI:false};
c.vars={last_read_count_local:false,last_read_count_server:false,stream_count:undefined};c.templates.LoggedIn='<div class="{class:wrapper}">'+'<div class="{class:container}">'+'<a href="#" class="{class:notifyButton}">'+'<span class="{class:count}"></span>'+"</a>"+'<div class="{class:notifyStreamFrame}">'+'<div class="{class:notifyStreamFrameInner}"></div>'+'<div class="{class:notifyTitle}">Notifications</div>'+'<div class="{class:notifyBody}">'+' <div class="{class:stream}"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";c.templates.LoggedOut="";c.methods.userHandler=function(){if(this.user.is("logged")){if(this.config.get("debug"))this.log({message:"logged"});this.set("last_read_count_local",0);this.set("last_read_count_server",0);this.set("stream_count",0);var a=this.config.get("baseDomain");if(a.substring(a.length-1,a.length)==="/"){a=a.substring(0,a.length-1)}var b=a+"/im-notifications/"+this.user.get("identityUrl");this.config.set("stream_url",b);this.checkUser()}else{if(this.config.get("debug"))this.log({message:"not-logged"})}};c.methods.sendRequest=function(a,c,d,e){if(this.config.get("debug"))this.log({message:"sendRequest - executing"});var f=this;var g={crossDomain:true,api_key:this.config.get("imAppkey")};var h=b.extend(g,d);b.support.cors=true;var i="https://api.ideamelt.com/v1"+a;b.ajax({type:c,url:i,dataType:"json",data:h,cache:false,success:function(a){if(a.success)e(a);if(f.config.get("debug"))f.log({message:a})},error:function(){if(f.config.get("debug"))f.log({message:"sendRequest - error"})}})};c.methods.checkUser=function(){if(this.config.get("debug"))this.log({message:"checkUser - executing"});var a=this;var b="/user/create/";var c={user_url:this.user.get("identityUrl"),title:this.user.get("name"),avatar:this.user.get("avatar")};var d=function(b){if(a.config.get("debug"))a.log({message:"checkUser - successful"});a.checkLastReadCount();a.checkStreamCount();a.view.render({name:"stream"})};this.sendRequest(b,"POST",c,d)};c.methods.checkLastReadCount=function(){if(this.config.get("debug"))this.log({message:"checkLastReadCount - executing"});var a=this;var b="/notifications/count/";var c={user_url:this.user.get("identityUrl")};var d=function(b){if(a.config.get("debug"))a.log({message:"checkLastReadCount - successful"});if(a.config.get("debug"))a.log({message:"last_read_count = "+b["count"]});a.set("last_read_count_local",b["count"]);a.set("last_read_count_server",b["count"])};this.sendRequest(b,"GET",c,d)};c.methods.checkStreamCount=function(){if(this.config.get("debug"))this.log({message:"checkStreamCount - executing"});var a=this.config.get("baseDomain")+"/im-notifications/"+this.user.get("identityUrl");var c=this.get("request");if(!c){c=Echo.StreamServer.API.request({endpoint:"count",data:{q:"childrenof:"+a,appkey:this.config.get("appkey")},liveUpdatesTimeout:this.config.get("liveUpdatesInterval"),recurring:true,onError:b.proxy(this._error,this),onData:b.proxy(this.updateStreamCount,this),secure:this.config.get("useSecureAPI")});this.set("request",c)}c.send();if(this.config.get("debug"))this.log({message:"checkStreamCount - successful"})};c.methods.updateStreamCount=function(a){this.set("stream_count",a.count);if(this.config.get("debug"))this.log({message:"updateStreamCount - successful"});if(this.config.get("debug"))this.log({message:"stream_count = "+a.count});this.view.render({name:"count"})};c.methods.updateLastReadCount=function(){this.set("last_read_count_local",this.get("stream_count"));if(this.config.get("debug"))this.log({message:"updateLastReadCount - successful"});this.view.render({name:"count"})};c.methods.updateLastReadOnServer=function(){if(this.config.get("debug"))this.log({message:"updateLastReadOnServer - executing"});var a=this;var b="/notifications/count/";var c={user_url:this.user.get("identityUrl"),count:this.get("last_read_count_local"),update:true};var d=function(b){if(a.config.get("debug"))a.log({message:"updateLastReadOnServer - successful"})};if(this.get("last_read_count_server")!=this.get("last_read_count_local")){this.sendRequest(b,"POST",c,d)}return};c.methods.template=function(){return this.templates["Logged"+(this.user.is("logged")?"In":"Out")]};c.methods.domEvents=function(a){var c=this;if(a=="remove")b("html").off("click.notifier");else{b("html").on("click.notifier",function(a){if(!b(a.target).parents().hasClass(c.cssPrefix+"notifyStreamFrame")){if(c.view.get("notifyStreamFrame"))c.view.get("notifyStreamFrame").fadeOut(c.config.get("fadeToggleTimeout"));if(c.view.get("notifyButton"))c.view.get("notifyButton").removeClass(c.cssPrefix+"notifyButtonSelected")}})}};c.renderers.stream=function(a){if(this.config.get("debug"))this.log({message:"stream renderer - executing"});var b=this.user.get("identityUrl");var c=this.config.get("baseDomain");var d=c+"/im-notifications/"+b;var e=this.config.get("liveUpdatesInterval");this.initComponent({id:"Stream",component:"Echo.StreamServer.Controls.Stream",config:{target:a,query:"childrenof:"+d+" itemsPerPage:15 safeHTML:off children:0",state:{label:{icon:false,text:false}},item:{reTag:false,contentTransformations:{text:["hashtags","urls","newlines"],html:["hashtags","urls","newlines"],xhtml:["hashtags","urls"]}},liveUpdates:{enabled:true,timeout:e},flashColor:"#C6E9F6",useSecureAPI:this.config.get("useSecureAPI")}});return a};c.renderers.notifyButton=function(a){if(this.config.get("debug"))this.log({message:"notifyButton renderer - executing"});var c=this;a.off("click");a.on("click",function(a){a.preventDefault();a.stopPropagation();b(this).toggleClass(c.cssPrefix+"notifyButtonSelected");c.view.get("notifyStreamFrame").fadeToggle(c.config.get("fadeToggleTimeout"));c.updateLastReadCount();c.updateLastReadOnServer()});return a};c.renderers.count=function(a){if(this.config.get("debug"))this.log({message:"count renderer - executing"});var b=undefined;if(!this.get("last_read_count_local")||!this.get("last_read_count_server")){b=0;this.view.get("notifyButton").removeClass(this.cssPrefix+"notifyButtonLit")}else{if(this.get("stream_count")>this.get("last_read_count_local")){b=this.get("stream_count")-this.get("last_read_count_local");this.view.get("notifyButton").addClass(this.cssPrefix+"notifyButtonLit")}else{b=0;this.view.get("notifyButton").removeClass(this.cssPrefix+"notifyButtonLit")}}a.text(b);if(this.config.get("debug"))this.log({message:"count renderer - successful"});return a};c.css=".{class:wrapper} * { -webkit-box-sizing:border-box; -moz-box-sizing:border-box; box-sizing:border-box; }"+".{class:container} { position:relative; margin:0 auto; width:28px; height:28px;}"+".{class:notifyButton} { font-weight: bold; font-family: Arial,sans-serif; -webkit-border-radius: 1px; -moz-border-radius: 1px; border-radius: 1px; text-align: center; font-size: 15px; color: #aaa; background: #F8F8F8; background: -webkit-gradient(linear,left top,left bottom,from(#F8F8F8),to(#ECECEC)); background: -webkit-linear-gradient(top,#F8F8F8,#ECECEC); background: -moz-linear-gradient(top,#F8F8F8,#ECECEC); background: -ms-linear-gradient(top,#F8F8F8,#ECECEC); background: -o-linear-gradient(top,#F8F8F8,#ECECEC); background: linear-gradient(top,#F8F8F8,#ECECEC); border: 1px solid #c6c6c6; display: block; width: 28px; height: 28px; cursor:pointer; line-height:28px; margin:0 auto; -webkit-border-radius:1px; -moz-border-radius:1px; border-radius:1px; transition: box-shadow 0.1s ease-in-out; -webkit-transition: box-shadow 0.1s ease-in-out; -moz-transition: box-shadow 0.1s ease-in-out; -o-transition: box-shadow 0.1s ease-in-out; }"+".{class:notifyButton}:active, .{class:notifyButtonSelected} { box-shadow:inset 0 2px 3px rgba(0,0,0,0.1); }"+".{class:count} { cursor: inherit; }"+".{class:notifyStreamFrame} { display:none; position:absolute; width:300px; top: 43px; right: -136px; background:#fff; height:350px; border:1px solid #aaaaaa; -webkit-box-shadow:0 3px 8px rgba(0, 0, 0, .25);  -moz-box-shadow:0 3px 8px rgba(0, 0, 0, .25); box-shadow:0 3px 8px rgba(0, 0, 0, .25); z-index:101;}"+".{class:notifyTitle} { padding:10px; border-bottom:1px solid #ccc; font-size:13px; -webkit-box-shadow:0 1px 1px rgba(0, 0, 0, 0.1); -moz-box-shadow:0 1px 1px rgba(0, 0, 0, 0.1); box-shadow:0 1px 1px rgba(0, 0, 0, 0.1);}"+".{class:notifyBody} { padding: 10px;overflow-y: scroll;position: absolute;bottom: 0px;top: 41px;padding-top: 0; width:100%;}"+".{class:notifyStreamFrameInner} { position:relative;}"+'.{class:notifyStreamFrameInner}:after, .{class:notifyStreamFrameInner}:before {bottom: 100%;border: solid transparent;content: " ";height: 0;width: 0;position: absolute; pointer-events: none;}'+".{class:notifyStreamFrameInner}:after {border-color: rgba(255, 255, 255, 0);border-bottom-color: #ffffff;border-width: 8px;left: 50%;margin-left: -8px;}"+".{class:notifyStreamFrameInner}:before {border-color: rgba(170, 170, 170, 0);border-bottom-color: #aaaaaa;border-width: 9px;left: 50%;margin-left: -9px;}"+".{class:wrapper} .echo-streamserver-controls-stream-item-authorName {display:none}"+'.{class:notifyButtonLit} {background: #D14836; background: -webkit-gradient(linear,left top,left bottom,from(#DD4B39),to(#D14836)); background: -webkit-linear-gradient(top,#DD4B39,#D14836); background: -moz-linear-gradient(top,#DD4B39,#D14836); background: -ms-linear-gradient(top,#DD4B39,#D14836); background: -o-linear-gradient(top,#DD4B39,#D14836); background: linear-gradient(top,#DD4B39,#D14836); progid:DXImageTransform.Microsoft.gradient(startColorStr="#dd4b39",EndColorStr="#d14836"); border: 1px solid #C13828;color:#fff}'+".{class:body-item-username} {font-weight:bold}";Echo.App.create(c)}(Echo.jQuery);!function(a,b){!function(){var a;var c=function g(){};var d=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];var e=d.length;var f=b.console=b.console||{};while(e--){a=d[e];if(!f[a]){f[a]=c}}}();var c={};c.config={};c.baseConfig={targets:{stream:false,title:false,avatar:false,followees:false,followers:false},appkey:false,imAppkey:false,baseDomain:false,namespace:false,userUrl:false,liveUpdates:true,liveUpdatesInterval:300,debug:false,emptyTargets:true};c.init=function(b){if(!b)return this.log("error","config not provided");if(!b.targets)return this.log("error","targets not provided");if(!b.appkey)return this.log("error","appkey not provided");if(!b.imAppkey)return this.log("error","imAppkey not provided");if(!b.baseDomain)return this.log("error","baseDomain not provided");if(!b.namespace)return this.log("error","namespace not provided");this.config=a.extend(this.baseConfig,b);d.init({api_key:this.config.imAppkey});if(this.config.userUrl)this.getUser()};c.log=function(a,b){if(a=="error"){console.error(b);return false}else if(this.config.debug)console.log(b)};c.css=function(b){var c="";var d=null;if(c.length+b.length>1e5){d=null;c=""}var e=a('<style id="im-up-css" type="text/css">'+c+b+"</style>");if(d&&d.length){d.replaceWith(e)}else{a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(e)}};c.getUser=function(){var b=this;var c={user_url:this.config.userUrl};var e=function(a){b.user=a.user;if(b.config.emptyTargets)b.emptyTargets();b.initComponents()};var f=function(c){a.each(c.message_list,function(a,c){return b.log("error",c)})};d.send("UserExists",c,e,f)};c.changeUser=function(a){this.config.userUrl=a;this.getUser()};c.initComponents=function(){if(this.config.targets.stream)this.userStreamConstructor();if(this.config.targets.avatar)this.userAvatar();if(this.config.targets.title)this.userTitle();if(this.config.targets.followers)new this.Friends("followers",this.config.targets.followers,"UserFollowers",this.user,this.config.liveUpdates,this.config.liveUpdatesInterval);if(this.config.targets.followees)new this.Friends("followees",this.config.targets.followees,"UserFollowees",this.user,this.config.liveUpdates,this.config.liveUpdatesInterval)};c.emptyTargets=function(){var b=this.config.targets;a.each(b,function(b,c){a(c).empty()})};c.userStreamConstructor=function(){var a=this;if(this.userStream!=undefined){this.userStream.config.set("userUrls",[this.config.userUrl]);this.userStream.config.set("target",this.config.targets.stream);this.userStream.refresh()}else{Echo.Loader.initApplication({script:"http://ideamelt.com/static/apps/3.0/im.socialstream.js",component:"IdeaMelt.Apps.SocialStream",config:{target:this.config.targets.stream,appkey:this.config.appkey,imAppkey:this.config.imAppkey,namespace:this.config.namespace,baseDomain:this.config.baseDomain,personalize:false,userUrls:[this.config.userUrl],aggregator:false,compact:false,ready:function(){a.userStream=this}}})}};c.userAvatar=function(){var b=a("<img>").attr("src",this.user.avatar);var c=b[0].naturalHeight;var d=b[0].naturalWidth;if(c>=d)b.addClass("im-up-avatar-h");else b.addClass("im-up-avatar-w");b.appendTo(this.config.targets.avatar)};c.userTitle=function(){a("<div>").addClass("im-up-title").text(this.user.title).appendTo(this.config.targets.title)};c.Friends=function(a,c,d,e,f,g){this.instance=a;this.div=c;this.endpoint=d;this.user=e;var h=this;if(f)this.interval=b.setInterval(function(){h.getData()},g*1e3);this.getData()};c.Friends.prototype.getData=function(){var a=this;var b={user_url:this.user.url};var c=function(b){var c=a.instance+"_list";a.assembleHtml(b[c])};d.send(a.endpoint,b,c)};c.Friends.prototype.assembleHtml=function(b){var c=[];a.each(b,function(b,d){var e=a("<a>").attr("class","im-up-fi").attr("href",d.url),f=a("<div>").attr("class","im-up-fi-title").text(d.title),g=a("<div>").attr("class","im-up-fi-img"),h=a("<img>").attr("src",d.avatar),i=h[0].naturalHeight,j=h[0].naturalWidth;if(i>=j)h.addClass("im-up-avatar-h");else h.addClass("im-up-avatar-w");h.appendTo(g);g.appendTo(e);f.appendTo(e);c.push(e)});a(this.div).empty().append(c)};c.css(".im-up-avatar-w {max-height: 100%; min-height: 100%; vertical-align: middle; border: 0; -ms-interpolation-mode: bicubic;}");c.css(".im-up-avatar-h {max-width: 100%; min-width: 100%; vertical-align: middle; border: 0; -ms-interpolation-mode: bicubic;}");c.css(".im-up-fi-img {width: 58px; height: 58px; overflow: hidden;}");var d=b.IdeaMelt||{};d.Apps=b.IdeaMelt.Apps||{};d.Apps.UserProfile=function(a){return this.init(a)};d.Apps.UserProfile.prototype=c}($,window);